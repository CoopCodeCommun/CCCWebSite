# Preface
There's no point in making free software if we don't explain how and why we do it. So the first step we need to do is: documentation and popularization.

We may start with a participatory project? Every Monday: "code together"!

The idea: Coding from the begining  the entire LaBoutik project (cash register, cashless, local currency, etc... to find out more: https://tibillet.org).

Step by step, we'll detail why and how we build it.

The stated goal is to encourage contributions to the cooperative's projects, to reduce technological vagueness, to popularize the code, but above all to engage in a sharing-knowledge process.

# What to do?
In this tutoria we'll see how:
- Prepare your python development environment with Poetry
- Configure the Jetbrain IDE, Pycharm, to make development process easier
- Install Django 4.2
- Create your first objects in the database
- Create an admin interface to create and manipulate them

# Let's code the "LaBoutik" cash register software from scratch

### The “stack”:

In other words, all the libraries, frameworks and various tools to build our resolution.

- Linux (ubuntu/debian) although, we could install the stack on windows and mac, but we are going to choose  Linux.
- Python 3.10
- Poetry (python environment management tool which is used to keep our versions up to date and ensure that the libraries have no incompatibility with each other)
- Django 4.2
- And also our favorite IDE which makes our task much easier: Pycharm (https://www.jetbrains.com/fr-fr/pycharm/)

### GIT repository

Let's worn on the repository: https://github.com/CoopCodeCommun/LaBoutik-CodEnsamb

## Installing Poetry

- [https://python-poetry.org/docs/](https://python-poetry.org/docs/)

```shell=
curl -sSL https://install.python-poetry.org | python3 -
git clone git@github.com:CoopCodeCommun/LaBoutik-CodEnsamb.git
```
On Mac : 
```shell=
brew install poetry
```

Once poetry installed and the git repository created. We can initialize the poetry.
At the root of the project : 
```shell=
poetry init
```
Answer the questions by checking
*Compatible Python versions [^3.10]:* - leave by default.
*For questions regarding dependencies, answer* - No (we will install them ourselves)


You now have a **pyproject.toml** file in your project which contains all the parameters entered.
Open this file, here you can enter the dependencies you want in the *[tool.poetry.dependencies]* section:
![](https://codimd.communecter.org/uploads/upload_b663a13e2226de8c483a1b4e9b747fef.png)

The *^* indicates minimum version
We will add Django to the command line by freezing the version using *@* (as of today October 2023 the version

```shell=
poetry add django@4.2
```
It will install the necessary dependencies for the project and creating the *poetry.lock* file which is the current state of our project.

>If you have cloned the project, the first 2 steps ```poetry init``` and ```poetry add django@4.2``` it won't be necessary. (they are needed if you are starting from scratch*)

Now let's enter and work in the virtual environment which allows us to have the same working environment whatever the OS used:
```shell=
poetry shell
```

the 'poetry shell' command make it possible to work on the
virtual environment.

## Installing and configuring Django

Let's create the project (the application)
```shell=
    django-admin startproject laboutik .
    // the dot '.' is used for having the root of the project where we are located
    ./manage.py startapp labutik_core
    ./manage.py runserver
```

idem the first 2 commands above are no longer necessary if you have alredy cloned the project.

In laboutik/settings.py on ajoute:
```shell=
    INSTALLED_APPS = [
    ...,
    'laboutik_core',
    ]
    
    AUTH_USER_MODEL = 'laboutik_core.CustomUser'
```
Dajngo needs a DB, let's create it.
```shell=
./manage.py migrat
```
We can allredy see a new data base in our project:
![](https://codimd.communecter.org/uploads/upload_1bd46a93d9d713f32601e0efc53f7873.png)

Also in settings file: 
![](https://codimd.communecter.org/uploads/upload_3df05cceccef8245a1467116db77411c.png)

In local we can use sqlite3. Later in production we can use a better and well adapted BD

the command ```./manage.py runserver ``` starts the server.
Now by connecting to the address: http://127.0.0.1:8000/ you should have the page below:

![](https://codimd.communecter.org/uploads/upload_3095d9553a558ca4f5024567eeb12c7f.png)

### Configurating Pycharm
We haven't jet indicated to Pycharm our environment. We must signal it that we are working with Python3.10, Poetry and Django.
Let's configure the interpreter, in Pycharm settings:
![](https://codimd.communecter.org/uploads/upload_c47a858894d9007d560bf34272948d6f.png)

Add interpreter/Local/Poetry environement : 
![](https://codimd.communecter.org/uploads/upload_ca5d21bf2d08a1646387fd63c7625a5e.png)

In "Poetry executable" indicate the root of poetry that was recently installed.

Let's verify the configuration for Django : 
![](https://codimd.communecter.org/uploads/upload_5f9d1348c6b8fc49c2f197b05110e3d2.png)

So now Pycharm will alert us in the event of a syntax error, offer auto-completion... so great :+1:

Thanks to JetBrains for supporting us with our projects.
To test if our IDE has understood our working environment, go to the urls.py file, place the cursor on "path" and press F12.
![](https://codimd.communecter.org/uploads/upload_62aa41db1310966ee8ab869fd0b63766.png)
You should be redirected to the conf.py file.
>Note for Mac:
>the keyboard shortcut is "fn + F12" if that doesn't work change the Keymap model to "sublime Text Copy"
>![](https://codimd.communecter.org/uploads/upload_6648e596509e95743c39491e099b7e68.png)



### The User Model

The creation of a custom user model is strongly recommended, without which it becomes
very complicated to modify the user model once our models are created or started.

In the models.py file:

```python=
from django.db import models
from django.contrib.auth.models import AbstractUser
from uuid import uuid4

class CustomUser(AbstractUser):
    """
    Modèle de base pour les utilisateurs
    On utilise des uuid4 plutôt que des pk auto-incrementés
    """
    uuid = models.UUIDField(primary_key=True, default=uuid4, editable=False, db_index=False)
```

And we apply the modifications by migrating:

```python=
from django.db import models
from django.contrib.auth.models import AbstractUser
from uuid import uuid4

class CustomUser(AbstractUser):
    """
    Modèle de base pour les utilisateurs
    On utilise des uuid4 plutôt que des pk auto-incrementés
    """
    uuid = models.UUIDField(primary_key=True, default=uuid4, editable=False, db_index=False)

```

in settings.py we can add:
```python=
    AUTH_USER_MODEL = 'laboutik_core.CustomUser'
```

### The basic architecture of the project

Lists of the "objects" that we'll need.

- Configuration
- Point of sales
- Categories
    - Product
        - VTAs (valued added tax)
    - Price
- Users
    - rights
- Paiment Methods
- Sale

### Creation of migration model db file


### Routing url
the files urls.py

the admin url allredy exists: 

```python
urlpatterns = [
    path('admin/', admin.site.urls),
]
```
Starting the serveur : 

```
./manage.py runserver
-> Starting development server at http://127.0.0.1:8000/
```
Ii we go to the further link http://127.0.0.1:8000/admin/
we'll have:

![](https://codimd.communecter.org/uploads/upload_16d13cc013a4cf7610ebcf2f5a794e3f.png)


### Django Administration

Let's create our admin user:
```
# Création of super user "root"
./manage.py createsuperuser
```

Attention,  createsuperuser creates users with is_staff = True AND is_superuser = True
Only is_staff is necessary to access the admin. is_superuser is comparable to a “ROOT” user who has full admin rights.


![](https://codimd.communecter.org/uploads/upload_f20bd7ef2d8895d60fba43854d39e6ba.png)

Save the modeles in admin: 

```python=
# laboutik_core/admin.py
from django.contrib import admin
from laboutik_core.models import Product, Price, VAT, Category, PointOfSale

# Register your models here.

admin.site.register(Product)
admin.site.register(Price)
admin.site.register(VAT)
admin.site.register(Category)
admin.site.register(PointOfSale)

```

![](https://codimd.communecter.org/uploads/upload_203c37f9e1c3d369fc36423d5458e115.png)


## Conclusion

We now have our environment installed and we can create database objects.

In the next sessions, we will see how to create our "frontend" with Jinja templates, and how to make this "MVT" stack modern with HTMX.
_________________________________________________________