<!doctype html>
<html lang="fr" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">2 articles tagués avec « traefik » | Coopérative Code Commun</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://codecommun.coop/img/Graphical_codecommun270.png"><meta data-rh="true" name="twitter:image" content="https://codecommun.coop/img/Graphical_codecommun270.png"><meta data-rh="true" property="og:url" content="https://codecommun.coop/blog/tags/traefik"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="keywords" content="Logiciel libre, coopérative, développement, informatique, Adhésion, billetterie, cashless, monnaie locale, monnaie temps, compagne de don, gestion de prise de commande buvette et restauration"><meta data-rh="true" property="og:title" content="2 articles tagués avec « traefik » | Coopérative Code Commun"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/CCClogo_node_color.svg"><link data-rh="true" rel="canonical" href="https://codecommun.coop/blog/tags/traefik"><link data-rh="true" rel="alternate" href="https://codecommun.coop/blog/tags/traefik" hreflang="fr"><link data-rh="true" rel="alternate" href="https://codecommun.coop/blog/tags/traefik" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Coopérative Code Commun RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Coopérative Code Commun Atom Feed">



<script src="https://plausible.codecommun.co/js/script.js" defer="defer" data-domain="codecommun.coop"></script><link rel="stylesheet" href="/assets/css/styles.8d0b4a40.css">
<link rel="preload" href="/assets/js/runtime~main.cfa75289.js" as="script">
<link rel="preload" href="/assets/js/main.28c11def.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/CCClogo_node_color.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/CCClogo_node_color.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Coopérative Code Commun</b></a><a class="navbar__item navbar__link" href="/docs/category/équipe">Équipe</a><a class="navbar__item navbar__link" href="/docs/category/créations">Créations</a><a class="navbar__item navbar__link" href="/docs/category/services">Services</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Recettes &amp; blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/CoopCodeCommun/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode sombre)" aria-label="Basculer entre le mode sombre et clair (actuellement mode sombre)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Navigation article de blog récent"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/python-unpacking">Python - L’unpacking</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sysadmin-mon-chaton-part2">Certificats TLS wildcard avec Letsencrypt, Docker, Traefik via OVH Cloud et Gandi.net</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/codensamb-preambule">Codons le logiciel de caisse enregistreuse &quot;LaBoutik&quot; depuis zero</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sysadmin-mon-chaton-part1">Linux, Docker, Compose, Traefik, Crowdsec, SSH, et c&#x27;est parti mon chaton !</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/libre-anar">Citation de Framatophe dans le Framablog</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sametmax">Citation de Sam et Max dans Hacker News</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/howl">HOWL - Hypermedia partout</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/prems">Première note du nouveau blog Code Commun !</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/federation-part5-fedow">Fédération 5 - FEDOW</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/federation-part4">Fédération 4 - Design</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/federation-part3">Fédération 3 - Structure et historique</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/federation-part2">Fédération 2 - L&#x27;agenda partagé</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/federation-part1">Fédération 1 - Introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/rtl-cr">RTL - Compte rendu 03-10-2022</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ecosocialisme_numerique">Ecosocialisme numérique</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/link">Liens utiles</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 articles tagués avec « traefik »</h1><a href="/blog/tags">Voir tous les tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://codecommun.coop/img/blog/sauvage.jpg"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/sysadmin-mon-chaton-part2">Certificats TLS wildcard avec Letsencrypt, Docker, Traefik via OVH Cloud et Gandi.net</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-08T00:00:00.000Z" itemprop="datePublished">8 novembre 2023</time> · <!-- -->8 minutes de lecture</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Nasjoe" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="/img/jojoCable300Carre.png" alt="Jonas Turbeaux"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Nasjoe" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jonas Turbeaux</span></a></div><small class="avatar__subtitle" itemprop="description">Charmeur de python</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="/img/blog/sauvage.jpg" src="/assets/images/sauvage-bdca871ed181cf44e12a51620a5858dc.jpg" width="672" height="384" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vous-avez-dit-sauvage-">Vous avez dit sauvage ?<a href="#vous-avez-dit-sauvage-" class="hash-link" aria-label="Lien direct vers Vous avez dit sauvage ?" title="Lien direct vers Vous avez dit sauvage ?">​</a></h2><p>Un certificat &quot;wildcard&quot; C&#x27;est un certificat qui répond à tous les sous-domaines d&#x27;un domaine. Par exemple,
si vous avez un certificat wildcard pour le domaine <code>*.example.com</code>, il sera valide
pour <code>foo.example.com</code>, <code>bar.example.com</code>, <code>prout.example.com</code>, etc.</p><p>Vous voyez le <code>*</code> ? C&#x27;est un caractère joker, qui signifie &quot;n&#x27;importe quoi&quot;. C&#x27;est pour cela qu&#x27;on appelle ça un
certificat wildcard, un sauvage.</p><p>Pourquoi faire ? Ben c&#x27;est quand même &#x27;achement pratique si on doit générer des sites en mode Saas, software as a
service. TiBillet, par exemple, est construit en mode multi-tenant. Cela veut dire un noyau unique pour plusieurs
instances fédérées. Chaque instance est un tenant, et chaque tenant possède son propre sous-domaine.</p><p>Dans le cas d&#x27;un déploiement en mode &quot;logiciel à la demande&quot;, c&#x27;est à dire avec des instances créées automatiquement en
quelques clics, avoir
un seul certificat valide pour les adresses comme <a href="https://raffinerie.tibillet.re/" target="_blank" rel="noopener noreferrer">https//raffinerie.tibillet.re/</a>
ou <a href="https://rezom.tibillet.re/" target="_blank" rel="noopener noreferrer">https://rezom.tibillet.re/</a> (notez le s de https),
c&#x27;est quand même assez chouette, non ?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lets-encrypt-et-traefik-lultra-combo">Let&#x27;s Encrypt et Traefik, l&#x27;ultra combo.<a href="#lets-encrypt-et-traefik-lultra-combo" class="hash-link" aria-label="Lien direct vers Let&#x27;s Encrypt et Traefik, l&#x27;ultra combo." title="Lien direct vers Let&#x27;s Encrypt et Traefik, l&#x27;ultra combo.">​</a></h2><p>Pour convaincre Letsencrypt de nous donner un certificat wildcard, il faut faire un petit peu plus de chose que pour un
certificat simple.
En plus de lui prouver que nous avons bien la main sur le serveur qui répond à l&#x27;ip résolu par le nom de domaine, il
faut ausi lui prouver que nous sommes les proprietaires de la totalité du domaine. Autrement dit : que nous avons les
droits d&#x27;écritures de toute la zone DNS.</p><p>Pour cela, Letsencrypt va nous demander d&#x27;ajouter un champ TXT dans la zone DNS du domaine. Ce champ contient une clé
créé par Letsencrypt, s&#x27;il arrive à le lire, il va donc considérer à raison que nous avons bien les droits d&#x27;écriture
sur la zone DNS. Donc que nous sommes le proprio.</p><p>Le truc, c&#x27;est qu&#x27;un certificat doit se renouveller régulièrement, et que donc, il faut que ce champ TXT soit présent et
différent à chaque renouvellement. Et on va pas se le cacher, c&#x27;est un peu contraignant et fastidieux de le faire à la
main.</p><p>C&#x27;est la qu&#x27;intervient Traefik. Traefik est un reverse proxy, c&#x27;est à dire un serveur qui va rediriger les requêtes http
vers le bon conteneur docker. Il est capable de faire plein de choses, mais ce qui nous intéresse ici, c&#x27;est qu&#x27;il est
capable de gérer les certificats SSL, et même de renouveller automatiquement les widlcards.</p><p>Traefik et Letsencrypt fonctionnent merveilleusement bien ensemble. Le premier va poser la question au second, puis va
modifier la zone DNS automatiquement pour que le champs TXT soit à jour régulièrement.
Cela nécessite de donner les trois d&#x27;écriture à notre Zone à notre conteneur Traefik.
Pas de soucis particuliers, l&#x27;instance Traefik est hebergé sur notre serveur, nous avons donc la main dessus..</p><p>Voyons comment mettre tout ça en place.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prérequis">Prérequis<a href="#prérequis" class="hash-link" aria-label="Lien direct vers Prérequis" title="Lien direct vers Prérequis">​</a></h2><ul><li>Un nom de domaine : Ici, nous allons voir la methode avec Gandi et avec OVH</li><li>Docker ( et docker-compose ) : <a href="https://docs.docker.com/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/install/</a></li><li>Traefik : <a href="https://docs.traefik.io/" target="_blank" rel="noopener noreferrer">https://docs.traefik.io/</a><ul><li>Nous avons un dépot avec tout dedans : <a href="https://github.com/TiBillet/" target="_blank" rel="noopener noreferrer">https://github.com/TiBillet/</a></li></ul></li><li>Un serveur ou heberger tout ça avec une ip statique et les ports 80 et 433 corectement redirigé. On utilise des VPS
sous Ubuntu, mais ça marche aussi avec une autre distribution ou même un raspberry pi.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Lien direct vers Installation" title="Lien direct vers Installation">​</a></h2><p>Je vous invite à aller du coté d&#x27;une précédente note de blog qui détaille comment préparer votre serveur pour la suite :
<a href="https://codecommun.coop/blog/sysadmin-mon-chaton-part1/" target="_blank" rel="noopener noreferrer">https://codecommun.coop/blog/sysadmin-mon-chaton-part1/</a></p><p>Une légère différence ceci, nous allons utiliser le fichier docker-compose.yml du dossier &quot;wildcard&quot; de notre dépot
github Traefik : <a href="https://github.com/TiBillet/Traefik-reverse-proxy/tree/main/wildcard" target="_blank" rel="noopener noreferrer">https://github.com/TiBillet/Traefik-reverse-proxy/tree/main/wildcard</a></p><p>Si vous avez déja lancé le docker-compose.yml de la note de blog, vous pouvez le stopper et le supprimer et utiliser
celui-ci à la place.</p><p>Si vous n&#x27;avez de compte ni sous OVH ni chez Gandi, pas d&#x27;inquiétude, Traefik supporte beaucoup de
registrar : <a href="https://doc.traefik.io/traefik/https/acme/?ref=j.hommet.net#dnschallenge" target="_blank" rel="noopener noreferrer">https://doc.traefik.io/traefik/https/acme/?ref=j.hommet.net#dnschallenge</a></p><p>Commençons par créer un nouveau champ A vers l&#x27;ip de votre serveur, avec comme sous domaine <code>*</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token number">10800</span><span class="token plain"> IN A </span><span class="token operator">&lt;</span><span class="token plain">IP</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, allons générer une clé API pour donner les droits d&#x27;écriture dans cette zone à Traefik : </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="avec-ovh-cloud">Avec OVH Cloud<a href="#avec-ovh-cloud" class="hash-link" aria-label="Lien direct vers Avec OVH Cloud" title="Lien direct vers Avec OVH Cloud">​</a></h2><p>Comme nous le disions, nous allons avoir besoin de donner les droits d&#x27;écriture à Traefik. Il vous faut bien sur un
compte ovh valide et avoir acheté un nom de domaine.</p><ul><li><p>Allez sur <a href="https://eu.api.ovh.com/createApp/" target="_blank" rel="noopener noreferrer">https://eu.api.ovh.com/createApp/</a></p></li><li><p>Logguez vous, créez une nouvelle app et récuperez les cred&#x27;</p></li><li><p>Dans le même dossier que le docker-compose, Créez un fichier .env et remplissez les deux premières variables avec les
cred&#x27; récupérés précédemment.</p></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">OVH_APPLICATION_KEY</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">OVH_APPLICATION_SECRET</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">OVH_CONSUMER_KEY</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Lancez cette commande curl pour donner les droits de modification à l&#x27;application. Remplacez OVH_APPLICATION_KEY
et VOTRE_DNS, avec vos propres valeurs.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -XPOST -H</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X-Ovh-Application: &lt;OVH_APPLICATION_KEY&gt;&quot;</span><span class="token plain"> -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Content-type: application/json&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://eu.api.ovh.com/1.0/auth/credential  -d </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    &quot;accessRules&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            &quot;method&quot;: &quot;POST&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            &quot;path&quot;: &quot;/domain/zone/&lt;VOTRE_DNS&gt;/record&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            &quot;method&quot;: &quot;POST&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            &quot;path&quot;: &quot;/domain/zone/&lt;VOTRE_DNS&gt;/refresh&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            &quot;method&quot;: &quot;DELETE&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            &quot;path&quot;: &quot;/domain/zone/&lt;VOTRE_DNS&gt;/record/*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    &quot;redirection&quot;:&quot;https://www.&lt;VOTRE_DNS&gt;/&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Si vous n&#x27;avez pas curl, installez le. Sinon, vous pouvez aussi utiliser l&#x27;application en ligne de OVH. Je vous laisse
découvrir par vous-même.</p><ul><li>Copiez le consumer_key et rentrez la variable correspondante dans le .env</li><li>Validez la requete avec le lien envoyé dans la réponse. Pensez à mettre unlimited dans la durée des droits d&#x27;execution
car Traefik renouvelle le widlcard tous les trois mois.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="avec-gandinet">Avec Gandi.net<a href="#avec-gandinet" class="hash-link" aria-label="Lien direct vers Avec Gandi.net" title="Lien direct vers Avec Gandi.net">​</a></h2><p>Un ptit peu plus simple du coté de Gandi, il suffit de générer une clé API dans votre compte user / Authentication
option / API key.</p><p>Dans votre .env, ajoutez la variable suivante :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">GANDI_API_KEY</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;PLOUFPLOUFDEVINEMOI&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="décollage">Décollage<a href="#décollage" class="hash-link" aria-label="Lien direct vers Décollage" title="Lien direct vers Décollage">​</a></h2><p>Completez votre .env avec EMAIL et DOMAIN, paske c&#x27;est le votre et pas le mien :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">DOMAIN</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pingoin-sauvage.coop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">EMAIL</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tux42@pingoin-sauvage.coop&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Et voici le compose magique :</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">traefik</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;traefik:saintmarcelin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;traefik_wild&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">log.level=DEBUG</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">api.insecure=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">providers.docker=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">providers.docker.exposedbydefault=false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.web.address=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.web.http.redirections.entrypoint.to=websecure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.web.http.redirections.entrypoint.scheme=https</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.websecure.address=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.websecure.http.tls=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.websecure.http.tls.certResolver=letsencrypt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.websecure.http.tls.domains</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">.main=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">entrypoints.websecure.http.tls.domains</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">.sans=</span><span class="token important">*.$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.dnschallenge=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.dnschallenge.provider=gandiv5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.dnschallenge.delayBeforeCheck=60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesResolvers.letsencrypt.acme.dnsChallenge.resolvers=1.1.1.1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">53</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">8.8.8.8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">53</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.email=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">EMAIL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.storage=/dnschallenge/acme.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.caserver=https</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//acme</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">staging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">v02.api.letsencrypt.org/directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;80:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;443:443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># choisissez votre provider. Gardez ceux de Gandi, ou ceux d&#x27;ovh, ou ceux indiqué par la doc Traefik.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;GANDIV5_API_KEY=${GANDIV5_API_KEY}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> OVH_APPLICATION_KEY=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">OVH_APPLICATION_KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> OVH_APPLICATION_SECRET=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">OVH_APPLICATION_SECRET</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> OVH_CONSUMER_KEY=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">OVH_CONSUMER_KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;./dnschallenge:/dnschallenge&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">frontend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">external</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Attention ! Deux choses à noter :</p><p>Pour gandi, ne touchez pas la ligne suivante :</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.dnschallenge.provider=gandiv5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour OVH, ou pour un autre registrar, il faudra bien le changer :</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">certificatesresolvers.letsencrypt.acme.dnschallenge.provider=ovh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cest-parti-">C&#x27;est parti !<a href="#cest-parti-" class="hash-link" aria-label="Lien direct vers C&#x27;est parti !" title="Lien direct vers C&#x27;est parti !">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># On lance le conteneur</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose up -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># on check les logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker logs -f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Attendez quelques instants que les logs se calment, et allons tester tout ceci avec un conteneur de test.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">whoami</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;traefik/whoami&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;simple-service&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.enable=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.docker.network=frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.http.routers.whoami.tls.certresolver=letsencrypt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.http.routers.whoami.tls.domains</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">.main=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.http.routers.whoami.tls.domains</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">.sans=</span><span class="token important">*.$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.http.routers.whoami.rule=HostRegexp(`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">sub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">+</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">.$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">`) </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> Host(`$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> traefik.http.routers.whoami.entrypoints=websecure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">frontend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">external</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notez la regex sur la règle DNS. Elle permet de matcher tous les sous-domaines de votre domaine. Sexy isn&#x27;t it ?</p><p>Si tout ce passe bien, dans les logs de Traefik, vous devriez voir quelque chose comme ça :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> traefik_wild  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">time</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2023-11-08T16:40:36Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">level</span><span class="token operator">=</span><span class="token plain">debug </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">msg</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;legolog: [INFO] [tibillet.coop] Server responded with a certificate.&quot;</span><span class="token plain">                                                            traefik_wild  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">time</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2023-11-08T16:40:36Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">level</span><span class="token operator">=</span><span class="token plain">debug </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">msg</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Certificates obtained for domains [tibillet.coop *.tibillet.coop]&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">providerName</span><span class="token operator">=</span><span class="token plain">letsencrypt.acme ACME </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CA</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://acme-v02.api.le</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">tsencrypt.org/directory&quot;</span><span class="token plain">             </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Si non, remontez bien les logs, le problème est forcément indiqué dedans.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="en-production-">En production ?<a href="#en-production-" class="hash-link" aria-label="Lien direct vers En production ?" title="Lien direct vers En production ?">​</a></h2><p>Ahah ! Par ce que vous pensiez que c&#x27;était fini ?</p><p>Le compose de Traefik contien une petite astuce, nous avons utilisé le serveur de test de Letsencrypt.
Pourquoi ? Eh bien le serveur de production qui génère de vrais certificats est soumis à une limite du nombre de
demande.</p><p>Je l&#x27;ai découvert à mes dépens, en voulant tester un peu trop de fois mon système, j&#x27;ai dû attendre quelques heures pour
pouvoir relancer un nouveau certificat... Le serveur de test nous permet par contre de se planter sans limite. J&#x27;adore.</p><p>Pour passer en production, lorsque les logs du conteneur traefik vous indiqueront que tout roule, il suffit de commenter
la ligne suivante :</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#      - --certificatesresolvers.letsencrypt.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Et hop, relancer en mode daemon :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enfin, re-lancez le conteneur whoami et vérifier qu&#x27;il matche bien. Remplacez bien sur le DNS par le votre, lancez le
conteneur, et allez vérifier sur votre navigateur que le certificat
est valide pour tout les sous-domaines que vous souhaitez (https://patate.votre_dns , https://prout.votre_dns, etc...)</p><p>Si ça coince, rechargez, videz vos certifs auto générés, et enfin regardez les logs Traefik, ce dernier vous signalera
forcement le problème dans un message d&#x27;erreur.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sources-et-liens-utiles-">Sources et liens utiles :<a href="#sources-et-liens-utiles-" class="hash-link" aria-label="Lien direct vers Sources et liens utiles :" title="Lien direct vers Sources et liens utiles :">​</a></h2><ul><li><a href="https://doc.traefik.io/traefik/user-guides/docker-compose/acme-dns/" target="_blank" rel="noopener noreferrer">https://doc.traefik.io/traefik/user-guides/docker-compose/acme-dns/</a></li><li><a href="https://www.grottedubarbu.fr/traefik-dns-challenge-ovh/" target="_blank" rel="noopener noreferrer">https://www.grottedubarbu.fr/traefik-dns-challenge-ovh/</a></li><li><a href="https://j.hommet.net/traefik-certificat-ssl-wildcard-letsencrypt/" target="_blank" rel="noopener noreferrer">https://j.hommet.net/traefik-certificat-ssl-wildcard-letsencrypt/</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags :</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ubuntu">ubuntu</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">linux</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wallet">wallet</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/traefik">traefik</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/crowsec">crowsec</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/administration-systeme">administration systeme</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/sysadmin">sysadmin</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ovh">ovh</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wildcard">wildcard</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/letsencrypt">letsencrypt</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/gandi">gandi</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://codecommun.coop/img/federons/decollage.jpg"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/sysadmin-mon-chaton-part1">Linux, Docker, Compose, Traefik, Crowdsec, SSH, et c&#x27;est parti mon chaton !</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-25T00:00:00.000Z" itemprop="datePublished">25 octobre 2023</time> · <!-- -->4 minutes de lecture</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Nasjoe" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="/img/jojoCable300Carre.png" alt="Jonas Turbeaux"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Nasjoe" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jonas Turbeaux</span></a></div><small class="avatar__subtitle" itemprop="description">Charmeur de python</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="/img/federons/decollage.jpg" src="/assets/images/decollage-4089ffd3f23c7012f1b8fa9b7474f30d.jpg" width="512" height="512" class="img_ev3q"></p><p>Nous allons détailler ici la préparation d&#x27;un serveur sous distribution Debian (ou Ubuntu) pour acceuillir toutes nos
solutions libres que nous proposons dans la coopérative.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="préparation-du-système">Préparation du système<a href="#préparation-du-système" class="hash-link" aria-label="Lien direct vers Préparation du système" title="Lien direct vers Préparation du système">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mises-à-jour-du-système">Mises à jour du système<a href="#mises-à-jour-du-système" class="hash-link" aria-label="Lien direct vers Mises à jour du système" title="Lien direct vers Mises à jour du système">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> upgrade -y</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sécuriser-le-serveur">Sécuriser le serveur<a href="#sécuriser-le-serveur" class="hash-link" aria-label="Lien direct vers Sécuriser le serveur" title="Lien direct vers Sécuriser le serveur">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="connexion-shh-par-clé">Connexion SHH par clé<a href="#connexion-shh-par-clé" class="hash-link" aria-label="Lien direct vers Connexion SHH par clé" title="Lien direct vers Connexion SHH par clé">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Depuis votre ordinateur client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssh-copy-id </span><span class="token operator">&lt;</span><span class="token plain">user</span><span class="token operator">&gt;</span><span class="token plain">@</span><span class="token operator">&lt;</span><span class="token plain">ip</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ou ajouter votre cle id_rsa.pub directement sur le serveur </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">nano</span><span class="token plain"> .ssh/authorized_keys </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="changer-le-port-découte-du-service-ssh-et-obliger-la-connexion-via-clé-ssh">Changer le port d&#x27;écoute du service SSH et obliger la connexion via clé ssh<a href="#changer-le-port-découte-du-service-ssh-et-obliger-la-connexion-via-clé-ssh" class="hash-link" aria-label="Lien direct vers Changer le port d&#x27;écoute du service SSH et obliger la connexion via clé ssh" title="Lien direct vers Changer le port d&#x27;écoute du service SSH et obliger la connexion via clé ssh">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">nano</span><span class="token plain"> /etc/ssh/sshd_config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Port 22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Port </span><span class="token number">2252</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># choisissez un port entre 1024 et 65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># On en profite pour autoriser l&#x27;agent forwarding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Cela sera trés utile pour pull/push des dépots git avec sa propre identité</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># plutôt que celle du serveur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AllowAgentForwarding </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Pour encore plus d&#x27;efficacité, on force la clé ssh.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># L&#x27;user n&#x27;en sera que plus reconnaissable, avec sa clé et son agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Attention à bien backuper votre clé. Si vous la perdez, vous perdez la main sur le serveur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># To disable tunneled clear text passwords, change to no here!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PasswordAuthentication no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#PermitEmptyPasswords no</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Attention, sur les serveurs VPS Ovh, un fichier de conf&#x27; ssh se cache dans le dossier /etc/ssh/sshd_config.d/ et permet
la connexion via mot de passe.
C&#x27;est utile pour la première connexion, mais ^ensez à le supprimer si vous voulez forcer la connexion par clé.</p><p>On recharge le daemon ssh :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> sshd reload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="installer-crowdsec">Installer Crowdsec<a href="#installer-crowdsec" class="hash-link" aria-label="Lien direct vers Installer Crowdsec" title="Lien direct vers Installer Crowdsec">​</a></h4><p>Crowdsec est une solution open source très utile pour gérer la sécurité de votre serveur.
Il utilise une liste de banissement d&#x27;ip géré par la communauté, surveille les iptables, et peut même s&#x27;interfacer avec
un reverse proxy pour surveiller les requetes http. Plus d&#x27;info ici :</p><ul><li><a href="https://www.crowdsec.net/" target="_blank" rel="noopener noreferrer">https://www.crowdsec.net/</a></li><li><a href="https://plugins.traefik.io/plugins/6335346ca4caa9ddeffda116/crowdsec-bouncer-traefik-plugin" target="_blank" rel="noopener noreferrer">https://plugins.traefik.io/plugins/6335346ca4caa9ddeffda116/crowdsec-bouncer-traefik-plugin</a></li></ul><p>Avant d&#x27;installer la solution, il est nécéssaire de créer un compte gratuit sur leur site.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> crowdsec</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> crowdsec-firewall-bouncer-iptables</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Allez sur l&#x27;interface Crowdsec et générez votre token d&#x27;invitation :</p><ul><li><a href="https://app.crowdsec.net/security-engines" target="_blank" rel="noopener noreferrer">https://app.crowdsec.net/security-engines</a></li></ul><p>Une commande du type suivant vous sera proposé :</p><p><code>sudo cscli console enroll ****</code></p><p>Lancez la, puis accepter l&#x27;invitation sur l&#x27;interface web.</p><p>Rebootez le serveur.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation-des-dépendances">Installation des dépendances<a href="#installation-des-dépendances" class="hash-link" aria-label="Lien direct vers Installation des dépendances" title="Lien direct vers Installation des dépendances">​</a></h3><p>Mes ptits softs que j&#x27;aime utiliser :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> byobu </span><span class="token function" style="color:rgb(80, 250, 123)">htop</span><span class="token plain"> borgbackup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="docker-">Docker :<a href="#docker-" class="hash-link" aria-label="Lien direct vers Docker :" title="Lien direct vers Docker :">​</a></h4><ul><li><a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/install/ubuntu/</a></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Un script d&#x27;installation est disponible, si vous ne voulez pas le faire a la main.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -fsSL https://get.docker.com -o get-docker.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Attention ! Vérifiez toujours le contenus des scripts téléchargé avant de les lancer en sudo ! </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> get-docker.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Ajoutez votre utilisteur au groupe docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">usermod</span><span class="token plain"> -aG </span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$USER</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Relancez une nouvelle session utilisateur pour prendre en compte les changements de groupes et vérifiez que vous avez
bien les droits :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="traefik">Traefik<a href="#traefik" class="hash-link" aria-label="Lien direct vers Traefik" title="Lien direct vers Traefik">​</a></h4><p>Traefik est un service de reverse proxy. C&#x27;est lui qui gère la redirection du conteneur depuis votre DNS et qui s&#x27;occupe
du chiffrement HTTPS grâce à la formidable initiative de lets&#x27;encrypt.</p><p>Pour le faire tourner, vous devez avoir un nom de domaine qui pointe vers l&#x27;ip de votre serveur. Ajoutez un champ A sur
votre admin DNS.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#clonez le dépot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone git@github.com:TiBillet/Traefik-reverse-proxy.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> Traefik-reverse-proxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Creez le sous réseau &quot;frontend&quot; commun</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> network create frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Lancez les conteneur en mode daemon</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> compose up -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Vérifiez que le conteneur tourne et qu&#x27;il écoute bien les ports 80 et 443 :</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID   IMAGE               COMMAND                  CREATED         STATUS         PORTS                                                                    NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7f27255b935a   traefik:chevrotin   </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/entrypoint.sh --lo…&quot;</span><span class="token plain">   </span><span class="token number">5</span><span class="token plain"> seconds ago   Up </span><span class="token number">4</span><span class="token plain"> seconds   </span><span class="token number">0.0</span><span class="token plain">.0.0:80-</span><span class="token operator">&gt;</span><span class="token number">80</span><span class="token plain">/tcp, :::80-</span><span class="token operator">&gt;</span><span class="token number">80</span><span class="token plain">/tcp, </span><span class="token number">0.0</span><span class="token plain">.0.0:443-</span><span class="token operator">&gt;</span><span class="token number">443</span><span class="token plain">/tcp, :::443-</span><span class="token operator">&gt;</span><span class="token number">443</span><span class="token plain">/tcp traefik</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testons-traefik-">Testons Traefik :<a href="#testons-traefik-" class="hash-link" aria-label="Lien direct vers Testons Traefik :" title="Lien direct vers Testons Traefik :">​</a></h4><p>Lançons un conteneur de test pour savoir si tout tourne bien :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> Traefik-reverse-proxy/test_conteneur</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;DOMAIN=localhost&quot;</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> .env </span><span class="token comment" style="color:rgb(98, 114, 164)"># créons un fichier .env qui sera lu par compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> compose up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Si vous allez dans <a href="https://test.localhost" target="_blank" rel="noopener noreferrer">https://test.localhost</a>, vous devriez voir une page whoami !</p><p>Si vous avez un DNS qui pointe vers l&#x27;ip de votre serveur, changez le .env en conséquence pour avoir une connexion
chiffrée en TLS !</p><h1>Conclusion</h1><p>Et Hop ! Notre serveur est prêt pour acceuillir tous nos services futurs.
Dans un prochain article, nous allons voir comment installer Traefik en mode Wildcard pour le moteur TiBillet d&#x27;adhésion, de reservation et d&#x27;agenda
fédéré !</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags :</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ubuntu">ubuntu</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">linux</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wallet">wallet</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/traefik">traefik</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/crowsec">crowsec</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/administration-systeme">administration systeme</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/sysadmin">sysadmin</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Pagination de la liste des articles du blog"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Plan du site</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/équipe">Équipe</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/créations">Créations</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/services">Services</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Communauté et Contacts</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chat.tiers-lieux.org/channel/TiBillet/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rocket Chat Tiers Lieux<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://chat.communecter.org/channel/tibillet/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rocket Chat Communecter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/pmVMJ4eMQB" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:contact@tibillet.re" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Divers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://codecommun.coop/blog/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flux RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/CoopCodeCommun/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Code Commun<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/TiBillet/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub TiBIllet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Tout les textes hébergés ici sont sous licence creative common : Attribution - Partage dans les Mêmes Conditions CC BY-SA</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cfa75289.js"></script>
<script src="/assets/js/main.28c11def.js"></script>
</body>
</html>