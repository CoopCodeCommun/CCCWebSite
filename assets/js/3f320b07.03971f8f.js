"use strict";(self.webpackChunkcc_cwebsite=self.webpackChunkcc_cwebsite||[]).push([[2702],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>g});var n=r(7294);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var i=n.createContext({}),u=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,s=e.mdxType,a=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(r),m=s,g=p["".concat(i,".").concat(m)]||p[m]||d[m]||a;return r?n.createElement(g,o(o({ref:t},c),{},{components:r})):n.createElement(g,o({ref:t},c))}));function g(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=r.length,o=new Array(a);o[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:s,o[1]=l;for(var u=2;u<a;u++)o[u]=r[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6435:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var n=r(7462),s=(r(7294),r(3905));const a={slug:"sysadmin-mon-chaton-part1",title:"Linux, Docker, Compose, Traefik, Crowdsec, SSH, et c'est parti mon chaton !",authors:"jonas",wiktags:["ubuntu","linux","wallet","traefik","crowsec","administration systeme","sysadmin"],tags:["ubuntu","linux","wallet","traefik","crowsec","administration systeme","sysadmin"],image:"/img/federons/decollage.jpg",description:'Installation et s\xe9curisation d\'un serveur linux "from scratch" pour acceuillir nos outils.',draft:!1},o=void 0,l={permalink:"/blog/sysadmin-mon-chaton-part1",editUrl:"https://github.com/CoopCodeCommun/CCCWebSite/blog/2023-10-27-Administration_serveur.md",source:"@site/blog/2023-10-27-Administration_serveur.md",title:"Linux, Docker, Compose, Traefik, Crowdsec, SSH, et c'est parti mon chaton !",description:'Installation et s\xe9curisation d\'un serveur linux "from scratch" pour acceuillir nos outils.',date:"2023-10-27T00:00:00.000Z",formattedDate:"27 octobre 2023",tags:[{label:"ubuntu",permalink:"/blog/tags/ubuntu"},{label:"linux",permalink:"/blog/tags/linux"},{label:"wallet",permalink:"/blog/tags/wallet"},{label:"traefik",permalink:"/blog/tags/traefik"},{label:"crowsec",permalink:"/blog/tags/crowsec"},{label:"administration systeme",permalink:"/blog/tags/administration-systeme"},{label:"sysadmin",permalink:"/blog/tags/sysadmin"}],readingTime:3.07,hasTruncateMarker:!1,authors:[{name:"Jonas Turbeaux",title:"Charmeur de python",url:"https://github.com/Nasjoe",imageURL:"/img/jojoCable300Carre.png",key:"jonas"}],frontMatter:{slug:"sysadmin-mon-chaton-part1",title:"Linux, Docker, Compose, Traefik, Crowdsec, SSH, et c'est parti mon chaton !",authors:"jonas",wiktags:["ubuntu","linux","wallet","traefik","crowsec","administration systeme","sysadmin"],tags:["ubuntu","linux","wallet","traefik","crowsec","administration systeme","sysadmin"],image:"/img/federons/decollage.jpg",description:'Installation et s\xe9curisation d\'un serveur linux "from scratch" pour acceuillir nos outils.',draft:!1},nextItem:{title:'Codons le logiciel de caisse enregistreuse "LaBoutik" depuis zero',permalink:"/blog/codensamb-preambule"}},i={authorsImageUrls:[void 0]},u=[{value:"Pr\xe9paration du syst\xe8me",id:"pr\xe9paration-du-syst\xe8me",level:2},{value:"Mises \xe0 jour du syst\xe8me",id:"mises-\xe0-jour-du-syst\xe8me",level:3},{value:"S\xe9curiser le serveur",id:"s\xe9curiser-le-serveur",level:3},{value:"Connexion SHH par cl\xe9",id:"connexion-shh-par-cl\xe9",level:4},{value:"Installer Crowdsec",id:"installer-crowdsec",level:4},{value:"Changer le port d&#39;\xe9coute du service SSH",id:"changer-le-port-d\xe9coute-du-service-ssh",level:4},{value:"Installation des d\xe9pendances",id:"installation-des-d\xe9pendances",level:3},{value:"Docker :",id:"docker-",level:4},{value:"Traefik",id:"traefik",level:4},{value:"Testons Traefik :",id:"testons-traefik-",level:4}],c={toc:u},p="wrapper";function d(e){let{components:t,...a}=e;return(0,s.kt)(p,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"/img/federons/decollage.jpg",src:r(2717).Z,width:"512",height:"512"})),(0,s.kt)("p",null,"Nous allons d\xe9tailler ici la pr\xe9paration d'un serveur sous VPS pour acceuillir toutes nos solutions libres que nous proposons dans la coop\xe9rative."),(0,s.kt)("h2",{id:"pr\xe9paration-du-syst\xe8me"},"Pr\xe9paration du syst\xe8me"),(0,s.kt)("h3",{id:"mises-\xe0-jour-du-syst\xe8me"},"Mises \xe0 jour du syst\xe8me"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt update\nsudo apt upgrade -y\nsudo reboot\n")),(0,s.kt)("h3",{id:"s\xe9curiser-le-serveur"},"S\xe9curiser le serveur"),(0,s.kt)("h4",{id:"connexion-shh-par-cl\xe9"},"Connexion SHH par cl\xe9"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"# Depuis votre ordinateur client\nssh-copy-id <user>@<ip>\n# ou ajouter votre cle id_rsa.pub directement sur le serveur \nnano .ssh/authorized_keys \n")),(0,s.kt)("h4",{id:"installer-crowdsec"},"Installer Crowdsec"),(0,s.kt)("p",null,"Crowdsec est une solution open source tr\xe8s utile pour g\xe9rer la s\xe9curit\xe9 de votre serveur.\nIl utilise une liste de banissement d'ip g\xe9r\xe9 par la communaut\xe9, surveille les iptables, et peut m\xeame s'interfacer avec\nun reverse proxy pour surveiller les requetes http. Plus d'info ici :"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://www.crowdsec.net/"},"https://www.crowdsec.net/")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://plugins.traefik.io/plugins/6335346ca4caa9ddeffda116/crowdsec-bouncer-traefik-plugin"},"https://plugins.traefik.io/plugins/6335346ca4caa9ddeffda116/crowdsec-bouncer-traefik-plugin"))),(0,s.kt)("p",null,"Avant d'installer la solution, il est n\xe9c\xe9ssaire de cr\xe9er un compte gratuit sur leur site."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"curl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | sudo bash\nsudo apt-get install crowdsec\nsudo apt install crowdsec-firewall-bouncer-iptables\n")),(0,s.kt)("p",null,"Allez sur l'interface Crowdsec et g\xe9n\xe9rez votre token d'invitation :"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://app.crowdsec.net/security-engines"},"https://app.crowdsec.net/security-engines"))),(0,s.kt)("p",null,"Une commande du type suivant vous sera propos\xe9 :"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"sudo cscli console enroll ****")),(0,s.kt)("p",null,"Lancez la, puis accepter l'invitation sur l'interface web."),(0,s.kt)("p",null,"Rebootez le serveur."),(0,s.kt)("h4",{id:"changer-le-port-d\xe9coute-du-service-ssh"},"Changer le port d'\xe9coute du service SSH"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"sudo nano /etc/ssh/sshd_config\n# Port 22\nPort 2252 # choisissez un port entre 1024 et 65535\n\n# On en profite pour autoriser l'agent forwarding\n# Cela sera tr\xe9s utile pour pull/push des d\xe9pots git avec sa propre identit\xe9\n# plut\xf4t que celle du serveur.\nAllowAgentForwarding yes\n")),(0,s.kt)("p",null,"On recharge le daemon ssh :"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"sudo service sshd reload\n")),(0,s.kt)("h3",{id:"installation-des-d\xe9pendances"},"Installation des d\xe9pendances"),(0,s.kt)("p",null,"Mes ptits softs que j'aime utiliser :"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt update\nsudo apt install git byobu htop borgbackup\n\n")),(0,s.kt)("h4",{id:"docker-"},"Docker :"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/ubuntu/"},"https://docs.docker.com/engine/install/ubuntu/"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"# Un script d'installation est disponible, si vous ne voulez pas le faire a la main.\ncurl -fsSL https://get.docker.com -o get-docker.sh\n# Attention ! V\xe9rifiez toujours le contenus des scripts t\xe9l\xe9charg\xe9 avant de les lancer en sudo ! \nsudo sh get-docker.sh\n# Ajoutez votre utilisteur au groupe docker\nsudo usermod -aG docker $USER\n")),(0,s.kt)("p",null,"Relancez une nouvelle session utilisateur pour prendre en compte les changements de groupes et v\xe9rifiez que vous avez\nbien les droits :"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"docker ps\n")),(0,s.kt)("h4",{id:"traefik"},"Traefik"),(0,s.kt)("p",null,"Traefik est un service de reverse proxy. C'est lui qui g\xe8re la redirection du conteneur depuis votre DNS et qui s'occupe\ndu chiffrement HTTPS gr\xe2ce \xe0 la formidable initiavide de lets'encrypt."),(0,s.kt)("p",null,"Pour le faire tourner, vous devez avoir un nom de domaine qui pointe vers l'ip de votre serveur. Ajoutez un champs A sur votre admin DNS."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'#clonez le d\xe9pot\ngit clone git@github.com:TiBillet/Traefik-reverse-proxy.git\ncd Traefik-reverse-proxy\n# Creez le sous r\xe9seau "frontend" commun\ndocker network create frontend\n# Lancez les conteneur en mode daemon\ndocker compose up -d\n# V\xe9rifiez que le conteneur tourne et qu\'il \xe9coute bien les ports 80 et 443 :\ndocker ps\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'CONTAINER ID   IMAGE               COMMAND                  CREATED         STATUS         PORTS                                                                    NAMES\n7f27255b935a   traefik:chevrotin   "/entrypoint.sh --lo\u2026"   5 seconds ago   Up 4 seconds   0.0.0.0:80->80/tcp, :::80->80/tcp, 0.0.0.0:443->443/tcp, :::443->443/tcp traefik\n')),(0,s.kt)("h4",{id:"testons-traefik-"},"Testons Traefik :"),(0,s.kt)("p",null,"Lan\xe7ons un conteneur de test pour savoir si tout tourne bien :"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'cd Traefik-reverse-proxy/test_conteneur\ncat "DOMAIN=localhost" > .env # cr\xe9ons un fichier .env qui sera lu par compose\ndocker compose up\n')),(0,s.kt)("p",null,"Si vous allez dans ",(0,s.kt)("a",{parentName:"p",href:"https://test.localhost"},"https://test.localhost"),", vous devriez voir une page whoami !"),(0,s.kt)("p",null,"Si vous avez un DNS qui pointe vers l'ip de votre serveur, changez le .env en cons\xe9quence pour avoir une connexion chiffr\xe9e en TLS !"),(0,s.kt)("h1",{id:"conclusion"},"Conclusion"),(0,s.kt)("p",null,"Et Hop ! Notre serveur est pr\xeat pour acceuillir tous nos services futurs.\nDans le prochain article, nous allons voir comment installer le moteur TiBillet d'adh\xe9sion, de reservation et d'agenda f\xe9d\xe9r\xe9 !"))}d.isMDXComponent=!0},2717:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/decollage-4089ffd3f23c7012f1b8fa9b7474f30d.jpg"}}]);